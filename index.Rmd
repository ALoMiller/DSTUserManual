--- 
title: "Northwest Atlantic Protected Species Decision Support Tool User Manual"
author: "version 4.2.00"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---

# Preparing the DST Model Run

## Example Base Run Code

To understand the setup of a DST model run, it's important to look at the basic code used to source the model code (including the version), set directories, and required model inputs. Model inputs are defined as a list object `InputList` with the required objects listed below. Finally, the model function `DecisionTool` is run.
```
rm(list=ls()) ## clear the global environment
HD="//net/work4/LobsterGroup/Management/RightWhales/DecisionSupportTool"; setwd(HD) ## set directory to where inputs will be read from 
Version="DST_V4.2.00.R" ## specify which DST version to load/run
source(paste0(HD, "/function_", Version)) ## load DST version/functions into R environment

## REQUIRED InputList INPUTS
InputList = list(
  HomeDir=HD, ## home directory for subdirectories
  ModelVersion=Version, ## model version
  InputActions=list(Name = "ScenarioName/Example.csv",
                    Source=”Wide”), ## see Section 1.2 Below
  MapRefDomain="MapRef_3.9.2.Rdata", ## MapRef version
  GearMapName = "FisheryInputs_AllEastCoast_v4.0.1.Rdata", ## fishery input layer
  ThreatModel="ThreatMod_RW_Selectivity_Uncertainty.Rdata", ## gear threat model
  WhaleHabitatModel="Duke_RightWhaleModel_v12_1019.Rdata", ## whale habitat model
WhaleVertDistInput=list(File="RightWhaleVerticalDistribution_CSA_V1.1.Rdata", Distribution="Ensemble"), ## whale vertical distribution
  WhaleDimensions="WhaleDimensions_AdHoc.Rdata", ## whale body dimensions
  CommentText = “Example Comment Text” ## comment text written to output tables
) 

DecisionTool(DecisionToolInputs = InputList) ## call DST function
```

## InputActions Structures 
Within `InputList`, `InputActions` defines the scenario or management actions to be tested. These user has the option to define these in either a saved spreadsheet .csv file or within the R code (explained in Section 1.2). For this example we have named our scenario "ScenarioName."

### Saved .csv File

When defining InputActions in the .csv file structure, an Excel spreadsheet (Ex. ScenarioTemplate_V4.0.0.xlsx) is used as a starting template for management. For each line, an action is specified and can be defined by fishery, spatial, and temporal bounds. Each additional column that subsets the action can be viewed as an "or" statement while each additional line (new action) can be viewed as an "and" statement. Commas can be used when specifying multiple entries for an individual cell. In this example InputActions spreadsheet there are four management actions. The first action restricts the model run to Gulf of Maine and Georges Bank (GOM_GBK) and Southern New England (SNE). The second action implements a closure to the lobster fishery in the South Island Restricted Area for January and February. The third action implements a year round closure to the gillnet fishery in Statistical Reporting Area 514. And the fourth action applies a gear reduction to state waters.

![](images/InputSpreadsheetExample.png)

This Excel spreadsheet should be saved with a new name for the scenario run with the .csv file extension in the InputSpreadsheets directory (Ex. DecisionSupportTool/InputSpreadsheets/ScenarioName/Example.csv). “Source” tells the DST what format the input is in so it can read in the scenario inputs properly.
```
InputActions = list(Name = “ScenarioName/Example.csv”,
	Source = “Wide”)
```
### Create List of Actions

As an alternative to creating a saved .csv file in the InputSpreadsheets folder for model InputActions, the user can write individual actions as lists within the R code itself. These lists are then joined into a larger list of complete actions, then merge together as list of lists to write into InputActions. Following the example from the Excel spreadsheet above, we can apply these same actions as an input list in R before running the model code. In this case each action (A1, A2, A3, A4) equates to a row in the spreadsheet.
```
A1 <- list(Action = "ModelConstraint", 
           Region = "GOM_GBK,SNE")
A2 <- list(Action = "Closure", 
           Fishery = "Lobster",
           Months = "1,2",
           Shapefile = "South_Island_Restricted_Area")
A3 <- list(Action = "Closure",
           Fishery = "Gillnet",
           StatArea = "514")
A4 <- list(Action = "GearReduction",
           StateFed = "State")
My.Input.List <- list(A1,A2,A3,A4)
```
Since the DST will not be reading in an existing .csv file, the user will need to supply a directory name that will be associated with these input scenario actions (ScenarioName). For this method, “Source” is now the name of the list of lists you’ve just created.
```
InputActions = list(Name = “ScenarioName/Example”,
	Source = My.Input.List)
```
Be sure not to put “.csv” file at end of “Example”. This will lead the model to look for a .csv file within the “InputSpreadsheets/ScenarioName” rather than read your list. 

### Rerun or Modify Previous Scenario

At the beginning of each DST model run, the model inputs and scenario `InputActions` are written into an .RData file within the ScenarioName with an extension "_DecisionToolInputs". To rerun or modify a model, this .RData file can be read back into the R environment. 
```
load(paste0(HD,"/Scenarios/ScenarioName/Example/Example_DecisionToolInputs.Rdata"))
```
To rerun the model as-is, a new `InputList` is not required and the DST function can be called as follows:
```
DecisionTool(DecisionToolInputs)
```
The user can also modify the inputs of this model and rerun by redefining elements within the. For example, to modify rerun the above example changing the fishery input layer that is used within the model from GearMapName = "FisheryInputs_AllEastCoast_v4.0.1.Rdata" to GearMapName = "FisheryInputs_Gillnet_v3.5.5.Rdata" the user would apply the following code:
```
DecisionToolInputs$GearMapName <- "FisheryInputs_Gillnet_v3.5.5.Rdata"
DecisionTool(DecisionToolInputs)
```
## Optional InputList Inputs

The example base run code provided in Section 1.1 lists the mandatory inputs required in the `InputList`. Additional optional inputs are detailed in the table below.

```{r, echo=FALSE, message=FALSE}
library(magrittr)
input.options <- readxl::read_excel('tables/OptionalInputList.xlsx') 
input.options$Notes <- gsub("\u00A0", " ", input.options$Notes, fixed = TRUE)
kableExtra::kable(input.options, "html") %>%
  kableExtra::kable_styling(font_size = 10.5) %>%
  kableExtra::scroll_box(width = "100%", box_css = "border: 0px;")
```

### Available Fisheries

### Available Scenario Actions
